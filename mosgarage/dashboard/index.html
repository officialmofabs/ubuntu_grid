<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MosGarage üöó‚ö°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script>
    const API_BASE = "http://localhost:3000";

    async function loadStatus() {
      try {
        let res = await fetch(API_BASE + "/status");
        let data = await res.json();
        document.querySelectorAll("[data-service]").forEach(el => {
          let name = el.dataset.service;
          let status = data[name] || "exited";
          let badge = el.querySelector(".status");
          if (String(status).toLowerCase().includes("running") || String(status).toLowerCase().includes("up")) {
            badge.innerText = "üü¢ Running";
            badge.className = "status text-green-600 font-semibold";
          } else {
            badge.innerText = "üî¥ Stopped";
            badge.className = "status text-red-600 font-semibold";
          }
        });
      } catch (e) {
        console.error("Status check failed", e);
      }
    }

    async function control(name, action) {
      try {
        const res = await fetch(API_BASE + `/${action}/${name}`, { method: "POST" });
        const data = await res.json();
        if (data.success) {
          loadStatus();
        } else {
          alert("Error: " + data.error);
        }
      } catch (e) {
        alert("API request failed: " + e.message);
      }
    }

    async function loadOnboarding() {
      try {
        let res = await fetch(API_BASE + "/onboarding");
        let data = await res.json();
        const list = document.getElementById("onboard-list");
        list.innerHTML = "";
        data.steps.forEach(s => {
          const li = document.createElement("li");
          li.innerText = s;
          list.appendChild(li);
        });
      } catch (e) {
        console.error("Onboarding failed", e);
      }
    }

    window.onload = () => {
      loadStatus();
      loadOnboarding();
      setInterval(loadStatus, 5000);
    };
  </script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-5xl mx-auto p-8">
    <h1 class="text-4xl font-bold text-center text-blue-700 mb-4">MosGarage üöó‚ö°</h1>
    <p class="text-center text-gray-600 mb-6">Your all-in-one local + cloud dev hub</p>

    <div class="mb-6 p-4 bg-white rounded shadow">
      <h2 class="text-xl font-semibold mb-2">Quick Onboarding</h2>
      <ol id="onboard-list" class="list-decimal ml-5 text-gray-700">
        <li>Loading‚Ä¶</li>
      </ol>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <div data-service="dev-core" class="bg-white shadow-lg rounded-2xl p-6">
        <h2 class="text-xl font-semibold text-blue-600 mb-2">IDE</h2>
        <p class="text-gray-600">Code-Server VSCode</p>
        <p class="status">‚è≥ Checking...</p>
        <div class="mt-3">
          <button onclick="control('dev-core','start')" class="bg-green-500 text-white px-3 py-1 rounded mr-2">Start</button>
          <button onclick="control('dev-core','stop')" class="bg-red-500 text-white px-3 py-1 rounded">Stop</button>
        </div>
        <a href="https://ide.localhost" class="text-blue-500 underline mt-2 block">Open</a>
      </div>

      <div data-service="sharepoint-dev" class="bg-white shadow-lg rounded-2xl p-6">
        <h2 class="text-xl font-semibold text-green-600 mb-2">SharePoint Dev</h2>
        <p class="text-gray-600">SPFx projects</p>
        <p class="status">‚è≥ Checking...</p>
        <div class="mt-3">
          <button onclick="control('sharepoint-dev','start')" class="bg-green-500 text-white px-3 py-1 rounded mr-2">Start</button>
          <button onclick="control('sharepoint-dev','stop')" class="bg-red-500 text-white px-3 py-1 rounded">Stop</button>
        </div>
        <a href="https://sharepoint.localhost" class="text-green-500 underline mt-2 block">Open</a>
      </div>

      <div data-service="powerapps-dev" class="bg-white shadow-lg rounded-2xl p-6">
        <h2 class="text-xl font-semibold text-purple-600 mb-2">PowerApps Dev</h2>
        <p class="text-gray-600">PAC CLI</p>
        <p class="status">‚è≥ Checking...</p>
        <div class="mt-3">
          <button onclick="control('powerapps-dev','start')" class="bg-green-500 text-white px-3 py-1 rounded mr-2">Start</button>
          <button onclick="control('powerapps-dev','stop')" class="bg-red-500 text-white px-3 py-1 rounded">Stop</button>
        </div>
        <a href="https://powerapps.localhost" class="text-purple-500 underline mt-2 block">Open</a>
      </div>

      <div data-service="teams-dev" class="bg-white shadow-lg rounded-2xl p-6">
        <h2 class="text-xl font-semibold text-indigo-600 mb-2">Teams Dev</h2>
        <p class="text-gray-600">TeamsFx apps</p>
        <p class="status">‚è≥ Checking...</p>
        <div class="mt-3">
          <button onclick="control('teams-dev','start')" class="bg-green-500 text-white px-3 py-1 rounded mr-2">Start</button>
          <button onclick="control('teams-dev','stop')" class="bg-red-500 text-white px-3 py-1 rounded">Stop</button>
        </div>
        <a href="https://teams.localhost" class="text-indigo-500 underline mt-2 block">Open</a>
      </div>

      <div data-service="functions-dev" class="bg-white shadow-lg rounded-2xl p-6">
        <h2 class="text-xl font-semibold text-red-600 mb-2">Functions Dev</h2>
        <p class="text-gray-600">Azure Functions</p>
        <p class="status">‚è≥ Checking...</p>
        <div class="mt-3">
          <button onclick="control('functions-dev','start')" class="bg-green-500 text-white px-3 py-1 rounded mr-2">Start</button>
          <button onclick="control('functions-dev','stop')" class="bg-red-500 text-white px-3 py-1 rounded">Stop</button>
        </div>
        <a href="https://functions.localhost" class="text-red-500 underline mt-2 block">Open</a>
      </div>
    </div>

    <footer class="mt-8 text-center text-gray-500">
      MosGarage ‚Äî your portable Microsoft Cloud dev garage
    </footer>
  </div>
</body>
</html>
